<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi Meter Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        :root { --red: #EF4444; --white: #FFFFFF; --bg: #F8F9FA; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh; }
        .hero-header { width: 100%; background-color: var(--red); padding: 35px 0 80px 0; display: flex; justify-content: center; align-items: center; }
        .hero-header img { height: 70px; width: auto; }
        .main-content { width: 100%; display: flex; flex-direction: column; align-items: center; margin-top: -55px; }
        .meter-card { background: var(--white); border-radius: 35px; width: 92%; max-width: 440px; padding: 45px 25px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.1); box-sizing: border-box; }
        .label { color: #9CA3AF; font-size: 14px; font-weight: 700; letter-spacing: 1.8px; text-transform: uppercase; margin-bottom: 8px; }
        .fare-display { font-size: 110px; font-weight: 900; color: #111827; margin: 5px 0; line-height: 1; letter-spacing: -4px; }
        .currency { color: var(--red); font-size: 45px; vertical-align: middle; margin-right: 8px; font-weight: 400; }
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 35px; border-top: 1px solid #F1F3F5; padding-top: 35px; }
        .stat-val { font-size: 36px; font-weight: 900; color: #111827; }
        .stat-unit { font-size: 14px; color: #6B7280; font-weight: 700; }
        .bottom-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 92%; max-width: 440px; margin-top: 20px; }
        .status-box { background: var(--white); border-radius: 22px; padding: 25px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.04); }
        .action-container { width: 100%; position: fixed; bottom: 35px; display: flex; justify-content: center; }
        .action-btn { width: 92%; max-width: 440px; padding: 24px; border-radius: 22px; border: none; font-size: 20px; font-weight: 900; color: var(--white); background: var(--red); text-transform: uppercase; cursor: pointer; }
    </style>
</head>
<body>
    <div class="hero-header"><img id="brand-logo" src="" alt="Logo"></div>
    <div class="main-content">
        <div class="meter-card">
            <div class="label">Live Fare</div>
            <div class="fare-display"><span class="currency">â‚¹</span><span id="fare">0</span></div>
            <div class="stats-row">
                <div><div class="label">Distance</div><div class="stat-val" id="dist">0.00<span class="stat-unit">KM</span></div></div>
                <div><div class="label">Waiting</div><div class="stat-val" id="wait">0<span class="stat-unit">MIN</span></div></div>
            </div>
        </div>
        <div class="bottom-row">
            <div class="status-box"><div class="label">Speed</div><div id="speed" style="font-size:28px; font-weight:900;">0.0</div></div>
            <div class="status-box"><div class="label">Status</div><div style="color:var(--red); font-weight:900; font-size:20px;">Premium Ride</div></div>
        </div>
    </div>
    <div class="action-container"><button id="btnMain" class="action-btn" onclick="tripAction()">Start Trip</button></div>

    <script>
        let isTripActive = false, totalDist = 0, currentFare = 0, waitMins = 0;
        let geoWatch, lastTime, lastPos;

        const urlData = new URLSearchParams(window.location.search);
        const brand = urlData.get('brand') || 'get';
        const tariff = urlData.get('t') || '1';
        
        document.getElementById('brand-logo').src = brand === 'red' ? "red-taxi.png" : "get-taxi.png";

        let config = { base: 80, rate: 25 };
        if(tariff === '2') config = { base: 100, rate: 25 };
        if(tariff === '3') config = { base: 80, rate: 27 };

        function tripAction() {
            if(!isTripActive) {
                isTripActive = true;
                currentFare = config.base;
                lastTime = Date.now();
                document.getElementById('btnMain').innerText = "Stop Trip";
                initTracking();
            } else { location.reload(); }
        }

        function initTracking() {
            geoWatch = navigator.geolocation.watchPosition(pos => {
                let now = Date.now();
                let elapsedMins = (now - lastTime) / 60000;
                
                if(lastPos) {
                    let d = getDist(lastPos.coords.latitude, lastPos.coords.longitude, pos.coords.latitude, pos.coords.longitude);
                    totalDist += d;
                    currentFare += (d * config.rate);
                    
                    // If moving slow, add waiting fare for elapsed time
                    if(pos.coords.speed < 0.3 || pos.coords.speed === null) {
                        waitMins += elapsedMins;
                        currentFare += (elapsedMins * 2); 
                    }
                }
                
                lastPos = pos;
                lastTime = now;
                document.getElementById('speed').innerText = (pos.coords.speed * 3.6 || 0).toFixed(1);
                updateUI();
            }, null, {enableHighAccuracy: true});
        }

        function getDist(la1, lo1, la2, lo2) {
            const R = 6371;
            const dLa = (la2-la1) * Math.PI/180;
            const dLo = (lo2-lo1) * Math.PI/180;
            const a = Math.sin(dLa/2)**2 + Math.cos(la1*Math.PI/180)*Math.cos(la2*Math.PI/180)*Math.sin(dLo/2)**2;
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        function updateUI() {
            document.getElementById('fare').innerText = Math.floor(currentFare);
            document.getElementById('dist').innerHTML = totalDist.toFixed(2) + '<span class="stat-unit">KM</span>';
            document.getElementById('wait').innerHTML = Math.floor(waitMins) + '<span class="stat-unit">MIN</span>';
        }
    </script>
</body>
</html>
